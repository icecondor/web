extends layout

block content

  div.page-dashboard
    div.dashboard.hidden
      | Dashboard
      = ' '
      span.username

    div.splash.hidden
      div.banner
        | Welcome to IceCondor
      div.intro
        | IceCondor provides advanced location services
      div.signin
        | Please sign in to begin.
      div.email-sent.hidden
        p
          | A login token has been sent to your email.
        p
          | Please click on the link in the email to continue.
      div.twologo.flexbox
        div.logo.flexbox
          img(src="/assets/logo.svg")
        div.playbutton.flexbox
          a(href="https://play.google.com/store/apps/details?id=com.icecondor.nest")
            img(src="http://developer.android.com/images/brand/Android_Robot_200.png")
            br
            img(alt="Android app on Google Play"
                src="https://developer.android.com/images/brand/en_app_rgb_wo_45.png")

  script.
    jQuery(function(){
      if(getKey()){
        statusTab("Loading")
        iceCondor.on('auth', function(auth_user){
          window.location = "/"+auth_user.user.username
          statusTab()
          $('.dashboard').show()
          var detail_tx = iceCondor.api('user.detail')
          iceCondor.onResponse(detail_tx, function(user){
            dashboard_detail(user)
          })
        })
      } else {
        $('.splash').removeClass('hidden')
      }
      iceCondor.on('email', function(sent){
        $('.signin').hide()
        $('.email-sent').show()
      })

      iceCondor.connect()

    })

    function dashboard_detail(user) {
      $('.page-dashboard .username').html('<a href="/'+user.username+'">'+user.username+'</a>')
    }
